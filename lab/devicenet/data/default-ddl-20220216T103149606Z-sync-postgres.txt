CREATE TABLE Devices (id VARCHAR(32) NOT NULL ,name VARCHAR(80) NOT NULL ,password VARCHAR(80) NOT NULL ,type VARCHAR(32) NOT NULL ,brand VARCHAR(32) NOT NULL ,model VARCHAR(32) NOT NULL ,so VARCHAR(80) NOT NULL ,imei VARCHAR(16)  ,imei2 VARCHAR(16)  ,mac VARCHAR(24)  ,macBluetooth VARCHAR(24)  ,ip VARCHAR(24)  ,CONSTRAINT Devices_PK PRIMARY KEY (id),CONSTRAINT Devices_UK UNIQUE (name));
CREATE TABLE Components (id VARCHAR(64) NOT NULL ,name VARCHAR(32) NOT NULL ,type VARCHAR(32) NOT NULL ,brand VARCHAR(32) NOT NULL ,model VARCHAR(32) NOT NULL ,deviceId VARCHAR(32) NOT NULL ,CONSTRAINT Components_PK PRIMARY KEY (id));
CREATE TABLE DeviceStatuses (id serial,deviceId VARCHAR(32) NOT NULL ,journeyId INTEGER  ,time TIMESTAMP NOT NULL ,latitude DECIMAL(10,4)  ,longitude DECIMAL(10,4)  ,altitude DECIMAL(10,4)  ,cpu DECIMAL(10,4)  ,cpuTemperature DECIMAL(10,4)  ,batery DECIMAL(10,4)  ,wifiSignal DECIMAL(10,4)  ,CONSTRAINT DeviceStatuses_PK PRIMARY KEY (id));
CREATE TABLE Journeys (id serial,deviceId VARCHAR(32) NOT NULL ,startId INTEGER  ,endId INTEGER  ,CONSTRAINT Journeys_PK PRIMARY KEY (id));
CREATE TABLE Files (id VARCHAR(255) NOT NULL ,type VARCHAR(16) NOT NULL ,deviceId VARCHAR(32) NOT NULL ,componentId VARCHAR(32) NOT NULL ,start TIMESTAMP  ,endId TIMESTAMP  ,CONSTRAINT Files_PK PRIMARY KEY (id));
CREATE TABLE Users (id VARCHAR(80) NOT NULL ,firstname VARCHAR(80) NOT NULL ,lastname VARCHAR(80) NOT NULL ,email VARCHAR(512) NOT NULL ,CONSTRAINT Users_PK PRIMARY KEY (id),CONSTRAINT Users_UK UNIQUE (email));
CREATE TABLE Groups (id VARCHAR(32) NOT NULL ,name VARCHAR(32) NOT NULL ,CONSTRAINT Groups_PK PRIMARY KEY (id),CONSTRAINT Groups_UK UNIQUE (name));
CREATE TABLE GroupUsers (id serial,userId VARCHAR(80) NOT NULL ,groupId VARCHAR(32) NOT NULL ,rol VARCHAR(32) NOT NULL ,CONSTRAINT GroupUsers_PK PRIMARY KEY (id),CONSTRAINT GroupUsers_UK UNIQUE (groupId,userId));
CREATE TABLE GroupDevices (id serial,deviceId VARCHAR(32) NOT NULL ,groupId VARCHAR(32) NOT NULL ,CONSTRAINT GroupDevices_PK PRIMARY KEY (id),CONSTRAINT GroupDevices_UK UNIQUE (groupId,deviceId));
ALTER TABLE Components ADD CONSTRAINT Components_device_FK FOREIGN KEY (deviceId) REFERENCES Devices (id);
CREATE INDEX DeviceStatuses_time ON DeviceStatuses (time);
ALTER TABLE DeviceStatuses ADD CONSTRAINT DeviceStatuses_device_FK FOREIGN KEY (deviceId) REFERENCES Devices (id);
ALTER TABLE DeviceStatuses ADD CONSTRAINT DeviceStatuses_journey_FK FOREIGN KEY (journeyId) REFERENCES Journeys (id);
CREATE INDEX Journeys_deviceId ON Journeys (deviceId);
ALTER TABLE Journeys ADD CONSTRAINT Journeys_device_FK FOREIGN KEY (deviceId) REFERENCES Devices (id);
ALTER TABLE Journeys ADD CONSTRAINT Journeys_start_FK FOREIGN KEY (startId) REFERENCES DeviceStatuses (id);
ALTER TABLE Journeys ADD CONSTRAINT Journeys_end_FK FOREIGN KEY (endId) REFERENCES DeviceStatuses (id);
ALTER TABLE Files ADD CONSTRAINT Files_device_FK FOREIGN KEY (deviceId) REFERENCES Devices (id);
ALTER TABLE Files ADD CONSTRAINT Files_component_FK FOREIGN KEY (componentId) REFERENCES Components (id);
ALTER TABLE GroupUsers ADD CONSTRAINT GroupUsers_group_FK FOREIGN KEY (groupId) REFERENCES Groups (id);
ALTER TABLE GroupUsers ADD CONSTRAINT GroupUsers_user_FK FOREIGN KEY (userId) REFERENCES Users (id);
ALTER TABLE GroupDevices ADD CONSTRAINT GroupDevices_group_FK FOREIGN KEY (groupId) REFERENCES Groups (id);
ALTER TABLE GroupDevices ADD CONSTRAINT GroupDevices_device_FK FOREIGN KEY (deviceId) REFERENCES Devices (id);